#+TITLE: Seq

* Kampfrunde
#+BEGIN_SRC plantuml :file kampf.png
actor Spieler as user
participant client
participant server

box "GameEngine"
  participant client
end box

box "GameServer"
  participant server
end box


loop
user -> client: Verteile Energie
client -> client: s.getPowerRequired()
client -> client: s.setPowerCurrent(int s)
client -> server: updateSection(s.setpowerCurrent(int Value)))
server -> client: energiekResponse(Ship s)
client -> user: Inform user of Change

end loop

loop
     user -> client: select Crew & Section by id
     client -> client: crewMemberController.setCremMemberDestination(Ship s, Crewmember c, Section sec)
     client -> client: shipController.findPath(Section s.getSections, Section start, Section End): List<Section>
     client -> client: updateCrewMember(Ship s, List<Section>, CrewMember c)
     client -> server: applyCrewSkills(Ship s)
     server -> client: crewMemberController.response(Ship s)
     client -> user: updateCrewMember()
end loop

loop
    user -> client: setTarget(Weapon w, Section sec, Ship s)
    client -> user: setTarget(Weapon w, Section sec, Ship s)

user -> client: Update Ship
client -> server: shipController.updateShip(Ship sNew)
    loop
         server -> server: getShip(ship): Ship
         server -> server: ship.getShield(): Shield
         server -> server: weaponController.canAttack(Weapon W, Shield): Boolean
         server -> server: weaponController.calculateDammage(Weapon w , Section s)
         server -> client: weaponController.applyAttack(Weapon w, Ship): Ship // HP, Shield
         client -> server: shipController.verifyResponse(Ship sNew): Boolean
    end loop
    client -> user: updateShip(Ship s)
client -> user: Inform user of Upadate Succes
end loop

user -> user: Confirm End of Round
actor Spieler as user
participant client
participant server

box "GameEngine"
  participant client
end box

box "GameServer"
  participant server
end box


loop
user -> client: Verteile Energie
client -> client: s.getPowerRequired()
client -> client: s.setPowerCurrent(int s)
client -> server: s.updateSection(s.setpowerCurrent(int Value)))
server -> client: shipController.energiekResponse(Ship s)
client -> user: Inform user of Change

end loop

loop
     user -> client: select Crew & Section by id
     client -> client: crewMemberController.setCremMemberDestination(Ship s, Crewmember c, Section sec)
     client -> client: shipController.findPath(Section s.getSections, Section start, Section End): List<Section>
     client -> client: updateCrewMember(Ship s, List<Section>, CrewMember c)
     client -> server: applyCrewSkills(Ship s)
     server -> client: crewMemberController.response(Ship s)
     client -> user: updateCrewMember()
end loop

loop
    user -> client: setTarget(Weapon w, Section sec, Ship s)
    client -> user: setTarget(Weapon w, Section sec, Ship s)

user -> client: Update Ship
client -> server: shipController.updateShip(Ship sNew)
    loop
         server -> server: getShip(ship): Ship
         server -> server: ship.getShield(): Shield
         server -> server: weaponController.canAttack(Weapon W, Shield): Boolean
         server -> server: weaponController.calculateDammage(Weapon w , Section s)
         server -> client: weaponController.applyAttack(Weapon w, Ship): Ship // HP, Shield
         client -> server: shipController.verifyResponse(Ship sNew): Boolean
    end loop
    client -> user: updateShip(Ship s)
client -> user: Inform user of Upadate Succes
end loop

user -> user: Confirm End of Round

#+END_SRC

#+RESULTS:
[[file:kampf.png]]




#+BEGIN_SRC plantuml :file example.png
actor Utilisateur as user
participant "formSign.js" as form <<Contrôleur formulaire>>
participant "Sign.java" as controler <<(C,#ADD1B2) Contrôleur formulaire>>
participant "Secure.java" as secure <<(C,#ADD1B2) authentification>>
participant "Security.java" as security <<(C,#ADD1B2) sécurité>>

box "Application Web" #LightBlue
	participant form
end box

box "Serveur Play" #LightGreen
	participant controler
	participant secure
	participant security
end box

user -> form : submitSignIn()
form -> form : getParameters()
form -> form : result = checkFields()

alt result

    form -> controler : formSignIn(email,pwd)
    controler -> controler : result = checkFields()

    alt result
    	controler -> secure : Secure.authenticate(email, pwd, true);
    	secure -> security : onAuthenticated()
    	security --> form : renderJSON(0);
    	form --> user : display main page
    else !result
    	controler --> form : renderJSON(1)
    	form --> user : display error
    end

else !result
	form --> user : display error
end

#+END_SRC

#+RESULTS:
[[file:example.png]]

* Client  / Server Kommunikaton
#+BEGIN_SRC plantuml :file sync.png
participant AgentInfoCache as cache
participant AgentInfoQuery as query
participant PollingRequestCallback as callback
participant AgentResponse as response
participant LibGDXAsyncRetriever as async

activate cache


    cache -> cache: Create Query for each host
    activate query
    cache -> query: run query
    query -> query: generate HTTPPingRequest
    query -> query: generate AgentResponse
    activate callback
    query -> callback: create a PollingRequestCallback
    deactivate callback
    callback -> query
    query -> response: agentResponse.getStatus(callBack)
    activate response
    response -> async: make HTTP Request
    activate async
    async -> async: submit the request
    deactivate response
    deactivate async
    async -> response: return future
    response -> query: return method
    deactivate query
    query -> callback: updateServer

#+END_SRC

#+RESULTS:
[[file:sync.png]]
